$(document).ready(function(){var s=$(".data-thumb-view").DataTable({processing:!0,serverSide:!0,responsive:!1,ajax:{url:window.location.href,data:function(e){e.min=$("#min-date").val(),e.max=$("#max-date").val()}},columns:[{data:"id"},{data:"action"},{data:"image"},{data:"orderNumber"},{data:"customers.name",defaultContent:"غير محدد"},{data:"machines.name",defaultContent:"غير محدد"},{data:"fileHeight"},{data:"fileWidth"},{data:"fileCopies",defaultContent:"0"},{data:"picInCopies",defaultContent:"0"},{data:"meters"},{data:"user.name",defaultContent:"غير محدد"},{data:"user2.name",defaultContent:"غير محدد"},{data:"notes",defaultContent:"-"},{data:"created_at"},{data:"timeEndOpration"}],columnDefs:[{targets:0,orderable:!1,className:"dt-checkboxes-cell",render:function(e,a,t,n){return'<div class="dt-checkboxes"><input type="checkbox" class="dt-checkboxes key_checkbox" value="'+t.id+'"><label></label></div>'},checkboxes:{selectRow:!0}},{targets:1,orderable:!1,render:function(e,a,t,n){return`<button type="button" class="btn btn-icon btn-flat-primary duplicate-order-btn" title="إعادة تشغيل" data-id="${t.id}">
                            <i class="feather icon-copy"></i>
                        </button>`}},{targets:2,orderable:!1,className:"product-img",render:function(e,a,t,n){let r=u+"core/images/elements/apple-watch.png";return t.orders_imgs&&t.orders_imgs.length>0&&(r="/storage/"+t.orders_imgs[0].path),`<input type="hidden" class="order_id" value="${t.id}">
                        <img style="height: 50px;" src="${r}" alt="Img">`}},{targets:5,render:function(e,a,t,n){return(t.machines?t.machines.name:"غير محدد")+" "+(t.pass?t.pass+" Pass":"")}},{targets:10,render:function(e,a,t,n){return"<b>"+parseFloat(e).toFixed(2)+" </b>"}},{targets:14,render:function(e,a,t,n){return e?new Date(e).toLocaleString("ar-EG"):""}},{targets:15,render:function(e,a,t,n){return e?new Date(e).toLocaleString("ar-EG"):"-"}}],dom:'<"top"<"actions action-btns"B><"action-filters"lf>><"clear">rt<"bottom"<"actions">p>',oLanguage:{sLengthMenu:"_MENU_",sSearch:""},aLengthMenu:[[10,20,50,100,200],[10,20,50,100,200]],select:{style:"multi"},order:[[14,"desc"]],bInfo:!1,pageLength:10,buttons:[],initComplete:function(e,a){$(".dt-buttons .btn").removeClass("btn-secondary");var t=$(".actions-dropodown");t.insertBefore($(".top .actions .dt-buttons")),s.rows({selected:!0}).count()>0?t.slideDown():t.hide()},drawCallback:function(){navigator.userAgent.indexOf("Mac OS X")!=-1&&$(".dt-checkboxes-cell input, .dt-checkboxes").addClass("mac-checkbox")}}),u=window.location.origin+"/";document.querySelector("base")&&(u=document.querySelector("base").href),$("#min-date, #max-date").on("change",function(){s.draw()}),s.on("select deselect",function(){var e=s.rows({selected:!0}).count();e>0?$(".actions-dropodown").slideDown():$(".actions-dropodown").slideUp(),f()}),$(document).on("click",".bulk-delete-btn",function(e){e.preventDefault();for(var a=s.rows({selected:!0}),t=[],n=a.data(),r=0;r<n.length;r++)t.push(n[r].id);if(t.length===0&&($(".dt-checkboxes:checked").each(function(){t.push($(this).val())}),t=[...new Set(t)]),t.length===0){Swal.fire({title:"تنبيه",text:"الرجاء تحديد طلب واحد على الأقل للحذف.",type:"warning",confirmButtonClass:"btn btn-primary",buttonsStyling:!1});return}Swal.fire({title:"هل انت متاكد من حذف "+t.length+" طلب؟",text:"لن تتمكن من التراجع عن هذا!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"نعم، احذفهم!",confirmButtonClass:"btn btn-primary",cancelButtonClass:"btn btn-danger ml-1",buttonsStyling:!1}).then(function(i){i.value&&$.ajax({url:"/printers/bulk-delete",type:"POST",data:{ids:t,_token:$('meta[name="csrf-token"]').attr("content")},success:function(o){s.draw(),$(".actions-dropodown").hide(),Swal.fire({type:"success",title:"تم الحذف!",text:"تم حذف الطلبات المحددة بنجاح.",showConfirmButton:!1,timer:1500,buttonsStyling:!1})},error:function(o){console.error("Bulk delete error:",o),Swal.fire({title:"خطأ!",text:"حدث خطأ أثناء الحذف. حاول مرة أخرى.",type:"error",confirmButtonClass:"btn btn-primary",buttonsStyling:!1})}})})}),$(document).on("click",".duplicate-order-btn",function(e){e.preventDefault();var a=$(this),t=a.data("id");if(!t){var n=a.closest("tr");t=n.find(".order_id").val()}Swal.fire({title:"تأكيد إعادة التشغيل",text:"سيتم إنشاء نسخة جديدة من هذا الطلب",type:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"نعم، أعد التشغيل",cancelButtonText:"إلغاء",confirmButtonClass:"btn btn-primary",cancelButtonClass:"btn btn-danger ml-1",buttonsStyling:!1}).then(function(r){if(r.value){var i=a.html();a.prop("disabled",!0).html('<i class="spinner-border spinner-border-sm"></i>'),$.ajax({url:"/printers/duplicate/"+t,type:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(o){Swal.fire({type:"success",title:"تمت العملية بنجاح!",text:"تم إعادة تشغيل الطلب بنجاح.",showConfirmButton:!1,timer:1500}).then(function(){toastr.success("تم إعادة تشغيل الطلب بنجاح","نجاح"),s.draw()})},error:function(o){a.prop("disabled",!1).html(i);var c="حدث خطأ أثناء العملية";o.responseJSON&&o.responseJSON.error&&(c=o.responseJSON.error),Swal.fire({title:"خطأ!",text:c,type:"error",confirmButtonClass:"btn btn-primary",buttonsStyling:!1})}})}})});function f(){var e=0,a=0,t=s.rows({selected:!0}).data(),n=t.count()>0;if(n){t.each(function(i){var o=parseFloat(i.meters)||0,c=parseInt(i.pass)||0,l=i.machines;e+=o;var d=0;l&&(c===1?d=parseFloat(l.price_1_pass)||0:c===4?d=parseFloat(l.price_4_pass)||0:c===6&&(d=parseFloat(l.price_6_pass)||0)),a+=o*d});var r="";e>0&&(r+='<span class="badge badge-info mb-1" style="font-size: 1em; margin-left:15px;"><i class="feather icon-maximize-2"></i>  طول الورق : '+e.toFixed(2)+" متر</span>"),a>0&&(r+='<span class="badge badge-primary mb-1" style="font-size: 1em; margin-left:15px;"><i class="feather icon-dollar-sign"></i> الاجمالي : '+a.toFixed(2)+" جنيه</span>"),$("#printer-log-calculator-results").html(r).slideDown()}else $("#printer-log-calculator-results").slideUp()}window.addToInvoice=function(){var e=s.rows({selected:!0}).data(),a=[];if(e.each(function(t){a.push(t.id)}),a.length===0){toastr.warning("Please select items first");return}$.post("/invoices/add",{_token:$('meta[name="csrf-token"]').attr("content"),ids:a,type:"printer"},function(t){toastr.success("تمت الاضافة للفاتورة"),t.cart_count!==void 0&&($(".cart-item-count").text(t.cart_count),$(".badge.badge-up.cart-item-count").text(t.cart_count)),t.cart_html&&$("#cart-dropdown-items").html(t.cart_html)}).fail(function(){toastr.error("حدث خطأ")})}});
