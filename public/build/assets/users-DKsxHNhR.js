$(document).ready(function(){$(".dt-buttons .btn-outline-primary").on("click",function(){$("#data-id").val(""),$("#data-name").val(""),$("#data-username").val(""),$("#data-email").val(""),$("#data-password").val(""),$("#data-base-salary").val(""),$("#data-working-hours").val("8"),$("#data-shift-start").val(""),$("#data-shift-end").val(""),$("#data-overtime-rate").val("1.5"),$("#data-joining-date").val(""),$("#data-resignation-date").val(""),$(".role-checkbox").prop("checked",!1),$(".add-new-data").addClass("show"),$(".overlay-bg").addClass("show")}),$(".hide-data-sidebar, .cancel-data-btn, .overlay-bg").on("click",function(r){r.stopPropagation(),$(".add-new-data").removeClass("show"),$(".overlay-bg").removeClass("show")}),$(document).on("click",".action-edit",function(r){r.stopPropagation();var t=$(this).closest("tr"),a=$(this),n=a.data("id")||t.find(".user_id").val(),s=a.data("name")||t.find(".user-name").text().trim(),o=a.data("username")||t.find(".user-username").text().trim(),u=a.data("email")||t.find(".user-email").text().trim(),i=[];t.find(".role-item").each(function(){i.push($(this).text().trim())});var v=a.data("base_salary")||"",c=a.data("working_hours")||"8",f=a.data("shift_start")||"",m=a.data("shift_end")||"",h=a.data("overtime_rate")||"1.5",l=a.data("joining_date")||"",p=a.data("resignation_date")||"";$("#data-id").val(n),$("#data-name").val(s),$("#data-username").val(o),$("#data-email").val(u),$("#data-password").val(""),$("#data-base-salary").val(v),$("#data-working-hours").val(c),$("#data-shift-start").val(f),$("#data-shift-end").val(m),$("#data-overtime-rate").val(h),$("#data-joining-date").val(l),$("#data-resignation-date").val(p),$(".role-checkbox").prop("checked",!1),i.forEach(function(e){$('.role-checkbox[value="'+e+'"]').prop("checked",!0)}),$(".add-new-data").addClass("show"),$(".overlay-bg").addClass("show")}),$(document).on("click",".action-delete",function(r){r.stopPropagation();var t=$(this).closest("td").parent("tr"),a=t.find(".user_id").val();if(!a){t.fadeOut();return}Swal.fire({title:"هل انت متاكد?",text:"لن تتمكن من التراجع عن هذا!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"نعم، احذفه!",confirmButtonClass:"btn btn-primary",cancelButtonClass:"btn btn-danger ml-1",buttonsStyling:!1}).then(function(n){n.value&&$.ajax({url:"/users/delete/"+a,type:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(s){t.fadeOut(function(){$(this).remove()}),Swal.fire({type:"success",title:"تم الحذف!",text:"تم حذف المستخدم بنجاح!",confirmButtonClass:"btn btn-success"})},error:function(s){console.error("Error deleting user:",s),Swal.fire({title:"خطأ!",text:"حدث خطأ أثناء الحذف.",type:"error",confirmButtonClass:"btn btn-primary",buttonsStyling:!1})}})})}),$("#saveDataBtn").on("click",function(r){r.preventDefault();var t=$("#data-id").val(),a=$("#data-name").val(),n=$("#data-username").val(),s=$("#data-email").val(),o=$("#data-password").val(),u=$("#data-base-salary").val(),i=$("#data-working-hours").val(),v=$("#data-shift-start").val(),c=$("#data-shift-end").val(),f=$("#data-overtime-rate").val(),m=$("#data-joining-date").val(),h=$("#data-resignation-date").val(),l=[];if($(".role-checkbox:checked").each(function(){l.push($(this).val())}),!a||!s||!n){Swal.fire({title:"خطأ!",text:"يرجى ادخال الاسم واسم المستخدم والبريد الالكتروني",type:"error",confirmButtonClass:"btn btn-primary",buttonsStyling:!1});return}if(!t&&!o){Swal.fire({title:"خطأ!",text:"يرجى ادخال كلمة المرور للمستخدم الجديد",type:"error",confirmButtonClass:"btn btn-primary",buttonsStyling:!1});return}var p=t?"/users/update/"+t:"/users/store";$.ajax({url:p,type:"POST",data:{name:a,username:n,email:s,password:o,base_salary:u,working_hours:i,shift_start:v,shift_end:c,overtime_rate:f,joining_date:m,resignation_date:h,roles:l,update_roles:!0,_token:$('meta[name="csrf-token"]').attr("content")},success:function(e){Swal.fire({type:"success",title:"تم الحفظ!",text:"تم حفظ البيانات بنجاح!",confirmButtonClass:"btn btn-success"}).then(()=>{location.reload()}),$(".add-new-data").removeClass("show"),$(".overlay-bg").removeClass("show")},error:function(e){console.error("Error saving user:",e);var d="حدث خطأ أثناء الحفظ";e.responseJSON&&e.responseJSON.message&&(d=e.responseJSON.message),e.responseJSON&&e.responseJSON.errors&&(d="",$.each(e.responseJSON.errors,function(g,b){d+=b[0]+`
`})),Swal.fire({title:"خطأ!",text:d,type:"error",confirmButtonClass:"btn btn-primary",buttonsStyling:!1})}})}),$(".hidee").css("display","none")});
