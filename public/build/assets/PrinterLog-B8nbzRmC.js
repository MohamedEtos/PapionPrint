$(document).ready(function(){var o=$(".data-thumb-view").DataTable({processing:!0,serverSide:!0,responsive:!1,ajax:{url:window.location.href,data:function(t){t.min=$("#min-date").val(),t.max=$("#max-date").val()}},columns:[{data:"id"},{data:"action"},{data:"image"},{data:"orderNumber"},{data:"customers.name",defaultContent:"غير محدد"},{data:"machines.name",defaultContent:"غير محدد"},{data:"fileHeight"},{data:"fileWidth"},{data:"fileCopies",defaultContent:"0"},{data:"picInCopies",defaultContent:"0"},{data:"meters"},{data:"user.name",defaultContent:"غير محدد"},{data:"user2.name",defaultContent:"غير محدد"},{data:"notes",defaultContent:"-"},{data:"created_at"},{data:"timeEndOpration"}],columnDefs:[{targets:0,orderable:!1,className:"dt-checkboxes-cell",render:function(t,a,e,n){return'<div class="dt-checkboxes"><input type="checkbox" class="dt-checkboxes key_checkbox" value="'+e.id+'"><label></label></div>'},checkboxes:{selectRow:!0}},{targets:1,orderable:!1,render:function(t,a,e,n){return`<button type="button" class="btn btn-icon btn-flat-primary duplicate-order-btn" title="إعادة تشغيل" data-id="${e.id}">
                            <i class="feather icon-copy"></i>
                        </button>`}},{targets:2,orderable:!1,className:"product-img",render:function(t,a,e,n){let r=u+"core/images/elements/apple-watch.png";return e.orders_imgs&&e.orders_imgs.length>0&&(r="/storage/"+e.orders_imgs[0].path),`<input type="hidden" class="order_id" value="${e.id}">
                        <img style="height: 50px;" src="${r}" alt="Img">`}},{targets:5,render:function(t,a,e,n){return(e.machines?e.machines.name:"غير محدد")+" "+(e.pass?e.pass+" Pass":"")}},{targets:10,render:function(t,a,e,n){return"<b>"+parseFloat(t).toFixed(2)+" </b>"}},{targets:14,render:function(t,a,e,n){return t?new Date(t).toLocaleString("ar-EG"):""}},{targets:15,render:function(t,a,e,n){return t?new Date(t).toLocaleString("ar-EG"):"-"}}],dom:'<"top"<"actions action-btns"B><"action-filters"lf>><"clear">rt<"bottom"<"actions">p>',oLanguage:{sLengthMenu:"_MENU_",sSearch:""},aLengthMenu:[[10,20,50,100,200],[10,20,50,100,200]],select:{style:"multi"},order:[[14,"desc"]],bInfo:!1,pageLength:10,buttons:[],initComplete:function(t,a){$(".dt-buttons .btn").removeClass("btn-secondary");var e=$(".actions-dropodown");e.insertBefore($(".top .actions .dt-buttons")),o.rows({selected:!0}).count()>0?e.slideDown():e.hide()},drawCallback:function(){navigator.userAgent.indexOf("Mac OS X")!=-1&&$(".dt-checkboxes-cell input, .dt-checkboxes").addClass("mac-checkbox")}}),u=window.location.origin+"/";document.querySelector("base")&&(u=document.querySelector("base").href),$("#min-date, #max-date").on("change",function(){o.draw()}),o.on("select deselect",function(){var t=o.rows({selected:!0}).count();t>0?$(".actions-dropodown").slideDown():$(".actions-dropodown").slideUp(),g()}),$(document).on("click",".bulk-delete-btn",function(t){t.preventDefault();for(var a=o.rows({selected:!0}),e=[],n=a.data(),r=0;r<n.length;r++)e.push(n[r].id);if(e.length===0&&($(".dt-checkboxes:checked").each(function(){e.push($(this).val())}),e=[...new Set(e)]),e.length===0){Swal.fire({title:"تنبيه",text:"الرجاء تحديد طلب واحد على الأقل للحذف.",type:"warning",confirmButtonClass:"btn btn-primary",buttonsStyling:!1});return}Swal.fire({title:"هل انت متاكد من حذف "+e.length+" طلب؟",text:"لن تتمكن من التراجع عن هذا!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"نعم، احذفهم!",confirmButtonClass:"btn btn-primary",cancelButtonClass:"btn btn-danger ml-1",buttonsStyling:!1}).then(function(l){l.value&&$.ajax({url:"/printers/bulk-delete",type:"POST",data:{ids:e,_token:$('meta[name="csrf-token"]').attr("content")},success:function(s){o.draw(),$(".actions-dropodown").hide(),Swal.fire({type:"success",title:"تم الحذف!",text:"تم حذف الطلبات المحددة بنجاح.",showConfirmButton:!1,timer:1500,buttonsStyling:!1})},error:function(s){console.error("Bulk delete error:",s),Swal.fire({title:"خطأ!",text:"حدث خطأ أثناء الحذف. حاول مرة أخرى.",type:"error",confirmButtonClass:"btn btn-primary",buttonsStyling:!1})}})})}),$(document).on("click",".duplicate-order-btn",function(t){t.preventDefault();var a=$(this),e=a.data("id");if(!e){var n=a.closest("tr");e=n.find(".order_id").val()}Swal.fire({title:"تأكيد إعادة التشغيل",text:"سيتم إنشاء نسخة جديدة من هذا الطلب",type:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"نعم، أعد التشغيل",cancelButtonText:"إلغاء",confirmButtonClass:"btn btn-primary",cancelButtonClass:"btn btn-danger ml-1",buttonsStyling:!1}).then(function(r){if(r.value){var l=a.html();a.prop("disabled",!0).html('<i class="spinner-border spinner-border-sm"></i>'),$.ajax({url:"/printers/duplicate/"+e,type:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(s){Swal.fire({type:"success",title:"تمت العملية بنجاح!",text:"تم إعادة تشغيل الطلب بنجاح.",showConfirmButton:!1,timer:1500}).then(function(){toastr.success("تم إعادة تشغيل الطلب بنجاح","نجاح"),o.draw()})},error:function(s){a.prop("disabled",!1).html(l);var c="حدث خطأ أثناء العملية";s.responseJSON&&s.responseJSON.error&&(c=s.responseJSON.error),Swal.fire({title:"خطأ!",text:c,type:"error",confirmButtonClass:"btn btn-primary",buttonsStyling:!1})}})}})});function g(){var t=0,a=0,e="",n=!1,r=o.rows({selected:!0}).data(),l=r.count(),s=l>0;if(s){n=l===1,r.each(function(i){var f=parseFloat(i.meters)||0,m=parseFloat(i.fileHeight)||0,p=parseFloat(i.picInCopies)||0,d=0;if(i.machines){var b=parseInt(i.pass)||0;b===4?d=parseFloat(i.machines.price_4_pass):b===6?d=parseFloat(i.machines.price_6_pass):d=parseFloat(i.machines.price_1_pass)}if(t+=f,a+=f*d,n)if(p>0&&m>0){var h=m/100/p*d;e=h.toFixed(2)}else e="0.00"});var c="";t>0&&(c+='<span class="badge badge-info mb-1" style="font-size: 1em; margin-left:15px;"><i class="feather icon-maximize-2"></i>  طول الورق : '+t.toFixed(2)+" متر</span>"),a>0&&(c+='<span class="badge badge-primary mb-1" style="font-size: 1em; margin-left:15px;"><i class="feather icon-dollar-sign"></i> الاجمالي : '+a.toFixed(2)+" جنيه</span>"),n&&e!==""&&(c+='<span class="badge badge-success mb-1" style="font-size: 1em; margin-left:15px;"><i class="feather icon-tag"></i> سعر القطعة : '+e+" جنيه</span>"),$("#printer-log-calculator-results").html(c).slideDown()}else $("#printer-log-calculator-results").slideUp()}window.addToInvoice=function(){var t=o.rows({selected:!0}).data(),a=[];if(t.each(function(e){a.push(e.id)}),a.length===0){toastr.warning("Please select items first");return}$.post("/invoices/add",{_token:$('meta[name="csrf-token"]').attr("content"),ids:a,type:"printer"},function(e){toastr.success("تمت الاضافة للفاتورة"),e.cart_count!==void 0&&($(".cart-item-count").text(e.cart_count),$(".badge.badge-up.cart-item-count").text(e.cart_count)),e.cart_html&&$("#cart-dropdown-items").html(e.cart_html)}).fail(function(){toastr.error("حدث خطأ")})},$(document).on("click",".product-img img",function(){var t=$(this).attr("src");t&&($("#enlarged-image").attr("src",t),$("#imageZoomModal").modal("show"))}),$(".close-zoom").on("click",function(){$("#imageZoomModal").modal("hide")})});
