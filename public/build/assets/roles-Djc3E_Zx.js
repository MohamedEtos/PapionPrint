$(document).ready(function(){$(".dt-buttons .btn-outline-primary").on("click",function(){$("#data-id").val(""),$("#data-name").val(""),$(".permission-checkbox").prop("checked",!1),$(".add-new-data").addClass("show"),$(".overlay-bg").addClass("show")}),$(".hide-data-sidebar, .cancel-data-btn, .overlay-bg").on("click",function(o){o.stopPropagation(),$(".add-new-data").removeClass("show"),$(".overlay-bg").removeClass("show")}),$(".action-edit").on("click",function(o){o.stopPropagation();var e=$(this).closest("td").parent("tr"),t=$(this).data("id"),a=$(this).data("name");t||(t=e.find(".role_id").val()),a||(a=e.find(".role-name").text().trim());var n=[];e.find(".perm-item").each(function(){n.push($(this).text().trim())}),$("#data-id").val(t),$("#data-name").val(a),$(".permission-checkbox").prop("checked",!1),n.forEach(function(r){$('.permission-checkbox[value="'+r+'"]').prop("checked",!0)}),$(".add-new-data").addClass("show"),$(".overlay-bg").addClass("show"),location.reload()}),$(".action-delete").on("click",function(o){o.stopPropagation();var e=$(this).closest("td").parent("tr"),t=e.find(".role_id").val();if(!t){e.fadeOut();return}Swal.fire({title:"هل انت متاكد?",text:"لن تتمكن من التراجع عن هذا!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"نعم، احذفه!",confirmButtonClass:"btn btn-primary",cancelButtonClass:"btn btn-danger ml-1",buttonsStyling:!1}).then(function(a){a.value&&$.ajax({url:"/roles/delete/"+t,type:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(n){e.fadeOut(function(){$(this).remove()}),Swal.fire({type:"success",title:"تم الحذف!",text:"تم حذف الدور بنجاح!",confirmButtonClass:"btn btn-success"})},error:function(n){console.error("Error deleting role:",n),Swal.fire({title:"خطأ!",text:"حدث خطأ أثناء الحذف.",type:"error",confirmButtonClass:"btn btn-primary",buttonsStyling:!1})}})})}),$("#saveDataBtn").on("click",function(o){o.preventDefault();var e=$("#data-id").val(),t=$("#data-name").val(),a=[];if($(".permission-checkbox:checked").each(function(){a.push($(this).val())}),!t){alert("يرجى ادخال اسم الدور");return}var n=e?"/roles/update/"+e:"/roles/store";$.ajax({url:n,type:"POST",data:{name:t,permissions:a,_token:$('meta[name="csrf-token"]').attr("content")},success:function(r){Swal.fire({type:"success",title:"تم الحفظ!",text:"تم حفظ البيانات بنجاح!",confirmButtonClass:"btn btn-success"}).then(()=>{location.reload()}),location.reload(),$(".add-new-data").removeClass("show"),$(".overlay-bg").removeClass("show")},error:function(r){console.error("Error saving role:",r),alert("Error saving role: "+(r.responseJSON.message||"Unknown error"))}})})});
