$(document).ready(function(){var i=$(".steps-validation").show();$(".steps-validation").steps({headerTag:"h6",bodyTag:"fieldset",transitionEffect:"fade",titleTemplate:'<span class="step">#index#</span> #title#',labels:{finish:"Submit"},onStepChanging:function(t,a,e){return a>e?!0:(a<e&&(i.find(".body:eq("+e+") label.error").remove(),i.find(".body:eq("+e+") .error").removeClass("error")),i.validate().settings.ignore=":disabled,:hidden",i.valid())},onFinishing:function(t,a){return i.validate().settings.ignore=":disabled",i.valid()},onFinished:function(t,a){d()}}),$(".steps-validation").validate({ignore:"input[type=hidden]",errorClass:"danger",successClass:"success",highlight:function(t,a){$(t).removeClass(a)},unhighlight:function(t,a){$(t).removeClass(a)},errorPlacement:function(t,a){t.insertAfter(a)}});var s=$(".data-thumb-view").DataTable({processing:!0,serverSide:!0,responsive:!1,ajax:{url:window.location.href},columns:[{data:"id"},{data:"action",orderable:!1,searchable:!1,defaultContent:""},{data:"image",orderable:!1,searchable:!1,defaultContent:""},{data:"customer.name",defaultContent:"-"},{data:"fabrictype",defaultContent:"-"},{data:"fabricsrc",defaultContent:"-"},{data:"fabriccode",defaultContent:"-"},{data:"fabricwidth",defaultContent:"-"},{data:"meters",defaultContent:"-"},{data:"status",defaultContent:"-"},{data:"papyershild",defaultContent:"-"},{data:"paymentstatus",defaultContent:"-"},{data:"price",defaultContent:"-"},{data:"notes",defaultContent:"-"},{data:"created_at",defaultContent:"-"},{data:"updated_at",defaultContent:"-"}],columnDefs:[{targets:0,orderable:!1,className:"dt-checkboxes-cell",render:function(t,a,e,n){return'<div class="dt-checkboxes"><input type="checkbox" class="dt-checkboxes key_checkbox" value="'+e.id+'"><label></label></div>'},checkboxes:{selectRow:!0}},{targets:1,render:function(t,a,e,n){return`<div class="btn-group" role="group">
                        <button type="button" class="btn btn-icon btn-flat-primary edit-btn" title="تعديل" data-id="${e.id}">
                            <i class="feather icon-edit"></i>
                        </button>
                        <button type="button" class="btn btn-icon btn-flat-danger delete-btn" title="حذف" data-id="${e.id}">
                            <i class="feather icon-trash-2"></i>
                        </button>
                    </div>`}},{targets:2,render:function(t,a,e,n){let r="/core/images/elements/apple-watch.png";return e.order&&e.order.orders_imgs&&e.order.orders_imgs.length>0&&(r="/storage/"+e.order.orders_imgs[0].path),`<img style="height: 50px;" src="${r}" alt="Img">`}},{targets:9,render:function(t,a,e,n){var r=t==1?"تم الانتهاء":"جاري العمل",o=t==1?"chip-success":"chip-warning";return`<div class="chip ${o}">
                      <div class="chip-body">
                        <div class="chip-text">${r}</div>
                      </div>
                    </div>`}},{targets:11,render:function(t,a,e,n){return t==1?'<span class="text-success">مدفوع</span>':'<span class="text-danger">غير مدفوع</span>'}},{targets:[14,15],render:function(t,a,e,n){return t?new Date(t).toLocaleString("ar-EG"):"-"}}],dom:'<"top"<"actions action-btns"B><"action-filters"lf>><"clear">rt<"bottom"<"actions">p>',oLanguage:{sLengthMenu:"_MENU_",sSearch:""},aLengthMenu:[[10,20,50,100],[10,20,50,100]],select:{style:"multi"},order:[[14,"desc"]],bInfo:!1,pageLength:10,buttons:[],initComplete:function(t,a){$(".dt-buttons .btn").removeClass("btn-secondary");var e=$(".actions-dropodown");e.insertBefore($(".top .actions .dt-buttons")),s.rows({selected:!0}).count()>0?e.slideDown():e.hide()}});s.on("select deselect",function(){var t=s.rows({selected:!0}).count();t>0?$(".actions-dropodown").slideDown():$(".actions-dropodown").slideUp()}),$(document).on("click",".bulk-delete-btn",function(t){t.preventDefault();for(var a=s.rows({selected:!0}),e=[],n=a.data(),r=0;r<n.length;r++)e.push(n[r].id);if(e.length===0&&($(".dt-checkboxes:checked").each(function(){e.push($(this).val())}),e=[...new Set(e)]),e.length===0){Swal.fire({title:"تنبيه",text:"الرجاء تحديد طلب واحد على الأقل للحذف.",type:"warning",confirmButtonClass:"btn btn-primary",buttonsStyling:!1});return}Swal.fire({title:"هل انت متاكد من حذف "+e.length+" طلب؟",text:"لن تتمكن من التراجع عن هذا!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"نعم، احذفهم!",confirmButtonClass:"btn btn-primary",cancelButtonClass:"btn btn-danger ml-1",buttonsStyling:!1}).then(function(o){o.value&&$.ajax({url:"/Rollpress/bulk-delete",type:"POST",data:{ids:e,_token:$('meta[name="csrf-token"]').attr("content")},success:function(u){s.draw(),$(".actions-dropodown").hide(),Swal.fire({type:"success",title:"تم الحذف!",text:"تم حذف الطلبات المحددة بنجاح.",showConfirmButton:!1,timer:1500,buttonsStyling:!1})},error:function(u){Swal.fire({title:"خطأ!",text:"حدث خطأ أثناء الحذف.",type:"error",confirmButtonClass:"btn btn-primary",buttonsStyling:!1})}})})}),$(document).on("click",".delete-btn",function(t){var a=$(this).data("id");Swal.fire({title:"هل انت متاكد من حذف هذا الطلب؟",text:"لن تتمكن من التراجع عن هذا!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"نعم، احذفه!",confirmButtonClass:"btn btn-primary",cancelButtonClass:"btn btn-danger ml-1",buttonsStyling:!1}).then(function(e){e.value&&$.ajax({url:"/Rollpress/bulk-delete",type:"POST",data:{ids:[a],_token:$('meta[name="csrf-token"]').attr("content")},success:function(n){s.draw(),Swal.fire({type:"success",title:"تم الحذف!",text:"تم حذف الطلب بنجاح.",showConfirmButton:!1,timer:1500,buttonsStyling:!1})},error:function(n){Swal.fire({title:"خطأ!",text:"حدث خطأ أثناء الحذف.",type:"error",confirmButtonClass:"btn btn-primary",buttonsStyling:!1})}})})});var l=null;$(document).on("click",".edit-btn",function(){var t=$(this).data("id"),a=s.row($(this).closest("tr")).data();l=t,$("#data-customer-view").val(a.customer?a.customer.name:""),$("#data-status").val(a.status==1?"تم الانتهاء":"جاري العمل"),$("#data-payment-status").val(a.paymentstatus),$("#data-fabric-type").val(a.fabrictype),$("#data-source").val(a.fabricsrc),$("#data-code").val(a.fabriccode),$("#data-width").val(a.fabricwidth),$("#data-meters").val(a.meters),$("#data-paper-shield").val(a.papyershild),$("#data-price").val(a.price),$("#data-notes").val(a.notes),$(".new-data-title").text("تعديل طلب رقم "+t),$("#validation").slideDown(),$("html, body").animate({scrollTop:$("#validation").offset().top-100},500)});function d(){if(l){var t=new FormData;t.append("_method","PUT"),t.append("_token",$('meta[name="csrf-token"]').attr("content")),t.append("customerName",$("#data-customer-view").val());var a=$("#data-customer-view").val(),e=$('#customers-list option[value="'+a+'"]');e.length>0&&t.append("customerId",e.attr("data-id")),t.append("status",$("#data-status").val()),t.append("paymentstatus",$("#data-payment-status").val()),t.append("fabrictype",$("#data-fabric-type").val()),t.append("fabricsrc",$("#data-source").val()),t.append("fabriccode",$("#data-code").val()),t.append("fabricwidth",$("#data-width").val()),t.append("meters",$("#data-meters").val()),t.append("papyershild",$("#data-paper-shield").val()),t.append("price",$("#data-price").val()),t.append("notes",$("#data-notes").val()),$.ajax({url:"/Rollpress/update/"+l,type:"POST",data:t,processData:!1,contentType:!1,success:function(n){toastr.success("تم تحديث الطلب بنجاح","نجاح"),$("#validation").slideUp(),l=null,c(),s.draw()},error:function(n){console.error(n),toastr.error("حدث خطأ أثناء التحديث","خطأ")}})}}$(document).on("click",".add-to-invoice-btn",function(t){t.preventDefault();for(var a=s.rows({selected:!0}),e=[],n=a.data(),r=0;r<n.length;r++)e.push(n[r].id);if(e.length===0&&($(".dt-checkboxes:checked").each(function(){e.push($(this).val())}),e=[...new Set(e)]),e.length===0){Swal.fire({title:"تنبيه",text:"الرجاء تحديد طلب واحد على الأقل للإضافة.",type:"warning",confirmButtonClass:"btn btn-primary",buttonsStyling:!1});return}$.post("/invoices/add",{_token:$('meta[name="csrf-token"]').attr("content"),ids:e,type:"rollpress_archive"},function(o){toastr.success("تمت الاضافة للفاتورة"),o.cart_count!==void 0&&($(".cart-item-count").text(o.cart_count),$(".badge.badge-up.cart-item-count").text(o.cart_count)),o.cart_html&&$("#cart-dropdown-items").html(o.cart_html)}).fail(function(){toastr.error("حدث خطأ")})});function c(){$("form.steps-validation")[0].reset(),$(".new-data-title").text("تعديل طلب")}});
